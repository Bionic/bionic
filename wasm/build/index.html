<html>
<head>
    <script src="wasm_exec.js"></script>
    <script>
        (function () {
            const go = new Go(); // Defined in wasm_exec.js
            const WASM_URL = 'bionic.wasm';

            if ('instantiateStreaming' in WebAssembly) {
                WebAssembly.instantiateStreaming(fetch(WASM_URL), go.importObject).then(function (obj) {
                    go.run(obj.instance);
                })
            } else {
                fetch(WASM_URL).then(resp =>
                    resp.arrayBuffer()
                ).then(bytes =>
                    WebAssembly.instantiate(bytes, go.importObject).then(function (obj) {
                        go.run(obj.instance);
                    })
                )
            }
        })();
    </script>
</head>
<body>
<button id="button">Open File</button>
<script>
    var worker
    (async function () {
        worker = new Worker("worker.sql-wasm.js");
        worker.onmessage = event => {
            console.log(event.data);
        };

        worker.postMessage({ action: 'open' });
        worker.postMessage({ action: 'exec', sql: "CREATE TABLE files (name, size);" });

        document.getElementById("button").addEventListener("click", async function () {
            const fileHandle = await window.showOpenFilePicker();
            const fileData = await fileHandle[0].getFile();

            const start = new Date();
            listZip(new Uint8Array(await fileData.arrayBuffer()), worker)
            const end = new Date();

            console.log("took " + (end.getTime() - start.getTime()) + "ms")
        })
    })();
</script>
</body>
</html>
